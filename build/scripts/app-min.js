'use strict';!function(){var e,a,t,n,r,c,i,s,o,d,m,l=(e=[],a=[],t=0,n=0,r=void 0,{init:function(a){var t=this;r=a,this.createCardNamesArray().forEach(function(a){var n=a.split('-').join(' of '),r=t.createCardFilenames(a),c=t.createCard(a,n,r);e.push(c)})},reset:function(){a=[],t=0,n=0},getRandomCards:function(){return a},getScore:function(){return t},createCard:function(e,a,t){return{dataId:e,alt:a,src:t}},createCardNamesArray:function(){return e=[],['Clubs','Diamonds','Hearts','Spades'].forEach(function(a){for(var t=1;t<14;t+=1)switch(t){case 1:e.push('Ace-'+a);break;case 11:e.push('Jack-'+a);break;case 12:e.push('Queen-'+a);break;case 13:e.push('King-'+a);break;default:e.push(t+'-'+a)}}),e;var e},createCardFilenames:function(e){return'images/'+e+'.svg'},makeRandomNumber:function(e){return Math.floor(Math.random()*e)},makeRandomPairs:function(t){for(var n=2*t,r=[];r.length<n;){var c=this.makeRandomNumber(52);r.includes(c)||r.push(c,c)}for(var i=r.length-1;i>0;i-=1){var s=this.makeRandomNumber(i+1),o=r[i];r[i]=r[s],r[s]=o}r.forEach(function(t){a.push(e[t])})},countingScore:function(e){'plus'===e?(t+=42*(r-(n+=1)),n===r&&_.win()):'minus'===e&&(t-=42*n)}}),u=(c=document.querySelector('.main__board'),i=void 0,{init:function(){var e=this.createElement('img',{className:'main__start-image',src:'images/StartGame.png'}),a=this.createElement('h1',{className:'main__title'},'memory game'),t=this.createElement('button',{className:'main__new-game',dataTid:'NewGame-startGame'},'Начать игру'),n=this.createElement('article',{className:'main__start-screen',dataTid:'App'},e,a,t);t.addEventListener('click',_.newGame),c.appendChild(n)},reset:function(){document.querySelector('.main__cards').remove()},win:function(e){var a=document.querySelector('.main__controls'),t=document.querySelector('.main__cards');a.remove(),t.remove();var n=this.createElement('img',{className:'main__win-image',src:'images/Group 2.png'}),r=this.createElement('p',{className:'main__win-title'},'Поздравляем!'),i=this.createElement('p',{className:'main__win-title'},'Ваш итоговый счет: '+e),s=this.createElement('button',{className:'main__win-new-game',dataTid:'EndGame-retryGame'},'Ещё раз'),o=this.createElement('article',{className:'main__win-screen'},n,r,i,s);s.addEventListener('click',_.newGame),c.appendChild(o)},createElement:function(e,a){var t=document.createElement(e);Object.keys(a).forEach(function(e){'dataId'===e?t.dataset.id=a[e]:'dataTid'===e?t.dataset.tid=a[e]:t[e]=a[e]});for(var n=arguments.length,r=Array(n>2?n-2:0),c=2;c<n;c++)r[c-2]=arguments[c];return r.forEach(function(e){var a=e;'string'==typeof a&&(a=document.createTextNode(e)),t.appendChild(a)}),t},newGame:function(e,a){var t=this,n=document.querySelector('.main__start-screen'),r=document.querySelector('.main__win-screen'),s=document.createDocumentFragment();if(!document.querySelector('.main__controls')){var o=this.createElement('span',{className:'controls__new-game',dataTid:'Menu-newGame'},'Начать заново'),d=this.createElement('span',{className:'controls__title'},'Очки: '),m=this.createElement('span',{className:'controls__score',dataTid:'Menu-scores'}),l=this.createElement('div',{className:'controls__wrapper'},d,m),u=this.createElement('section',{className:'main__controls'},o,l);o.addEventListener('click',_.resetGame),s.appendChild(u)}n&&n.remove(),r&&r.remove();var f=this.createElement('div',{className:'main__cards-grid',dataTid:'Deck'});e.forEach(function(e){var a=t.addCard(e.dataId,e.alt,e.src);f.appendChild(a)});var h=this.createElement('section',{className:'main__cards'},f);s.appendChild(h),c.appendChild(s),i=document.querySelector('.controls__score'),document.querySelectorAll('.main__card').forEach(function(e){e.addEventListener('click',_.onCardClick),setTimeout(function(){e.classList.add('card__flipped'),setTimeout(function(){e.classList.remove('card__flipped')},a)},100)})},addCard:function(e,a,t){var n=this.createElement('img',{src:'images/card_back.svg',alt:'Back of the card'}),r=this.createElement('div',{className:'card__back',dataTid:'Card-flipped'},n),c=this.createElement('img',{className:'card__icon',dataId:e,src:t,alt:a}),i=this.createElement('div',{className:'card__front'},c),s=this.createElement('div',{className:'main__card',dataTid:'Card'},r,i);return this.createElement('div',{className:'main__card-wrapper'},s)},openCard:function(e){e.target.classList.add('card__flipped')},noEventsOnCard:function(e){e.classList.add('card__no-events')},fadeOutPair:function(e,a){e.parentNode.classList.add('fade-out'),a.parentNode.classList.add('fade-out')},addShake:function(e,a){e.classList.add('shake'),a.classList.add('shake')},removeShake:function(e,a){e.classList.remove('shake'),a.classList.remove('shake')},closeBothCards:function(e,a){e.classList.remove('card__flipped','card__no-events'),a.classList.remove('card__flipped')},printScore:function(e){i.textContent=e}}),_=(s=500,o=null,d=null,m=!0,{init:function(){l.init(9),u.init(s)},newGame:function(){m=!1,l.reset(),l.makeRandomPairs(9),u.newGame(l.getRandomCards(),5e3),u.printScore(l.getScore()),setTimeout(function(){m=!0},5750)},resetGame:function(){l.reset(),u.reset(),u.printScore(l.getScore()),l.makeRandomPairs(9),u.newGame(l.getRandomCards(),5e3),o=null,d=null,m=!0},onCardClick:function(e){var a=e.target,t=a.querySelector('.card__icon').dataset.id;o&&m?(u.openCard(e),d===t?(m=!1,l.countingScore('plus'),setTimeout(function(){u.fadeOutPair(o,a),o=null,setTimeout(function(){m=!0},300)},s)):(m=!1,l.countingScore('minus'),setTimeout(function(){u.addShake(o,a),setTimeout(function(){u.removeShake(o,a),setTimeout(function(){u.closeBothCards(o,a),o=null,setTimeout(function(){m=!0},300)},100)},700)},s))):m&&(u.openCard(e),o=a,u.noEventsOnCard(o),d=o.querySelector('.card__icon').dataset.id,m=!1,setTimeout(function(){m=!0},200)),u.printScore(l.getScore())},win:function(){setTimeout(function(){u.win(l.getScore())},1250)}});_.init()}();