'use strict';!function(){var e,a,t,n,r,i,c,s,o,d,m,l,u=(e=[],a=[],t=0,n=0,r=void 0,{init:function(a){var t=this;r=a,this.createCardNamesArray().forEach(function(a){var n=a.split('-').join(' of '),r=t.createCardFilenames(a),i=t.createCard(a,n,r);e.push(i)})},reset:function(){a=[],t=0,n=0},getRandomCards:function(){return a},getScore:function(){return t},createCard:function(e,a,t){return{dataId:e,alt:a,src:t}},createCardNamesArray:function(){return e=[],['Clubs','Diamonds','Hearts','Spades'].forEach(function(a){for(var t=1;t<14;t+=1)switch(t){case 1:e.push('Ace-'+a);break;case 11:e.push('Jack-'+a);break;case 12:e.push('Queen-'+a);break;case 13:e.push('King-'+a);break;default:e.push(t+'-'+a)}}),e;var e},createCardFilenames:function(e){return'images/'+e+'.svg'},makeRandomNumber:function(e){return Math.floor(Math.random()*e)},makeRandomPairs:function(t){for(var n=2*t,r=[];r.length<n;){var i=this.makeRandomNumber(52);r.includes(i)||r.push(i,i)}for(var c=r.length-1;c>0;c-=1){var s=this.makeRandomNumber(c+1),o=r[c];r[c]=r[s],r[s]=o}r.forEach(function(t){a.push(e[t])})},countingScore:function(e){'plus'===e?(t+=42*(r-(n+=1)),n===r&&f.win()):'minus'===e&&(t-=42*n)}}),_=(i=document.querySelector('.main__board'),c=document.querySelector('audio'),s=void 0,{init:function(){var e=this.createElement('img',{className:'main__start-image',src:'images/StartGame.png'}),a=this.createElement('h1',{className:'main__title'},'memory game'),t=this.createElement('button',{className:'main__new-game',dataTid:'NewGame-startGame'},'Начать игру'),n=this.createElement('article',{className:'main__start-screen',dataTid:'App'},e,a,t);t.addEventListener('click',f.newGame),i.appendChild(n)},reset:function(){document.querySelector('.main__cards').remove()},win:function(e){var a=document.querySelector('.main__controls'),t=document.querySelector('.main__cards');a.remove(),t.remove();var n=this.createElement('img',{className:'main__win-image',src:'images/Group 2.png'}),r=this.createElement('p',{className:'main__win-title'},'Поздравляем!'),c=this.createElement('p',{className:'main__win-title'},'Ваш итоговый счет: '+e),s=this.createElement('button',{className:'main__win-new-game',dataTid:'EndGame-retryGame'},'Ещё раз'),o=this.createElement('article',{className:'main__win-screen'},n,r,c,s);s.addEventListener('click',f.newGame),i.appendChild(o)},createElement:function(e,a){var t=document.createElement(e);Object.keys(a).forEach(function(e){'dataId'===e?t.dataset.id=a[e]:'dataTid'===e?t.dataset.tid=a[e]:t[e]=a[e]});for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return r.forEach(function(e){var a=e;'string'==typeof a&&(a=document.createTextNode(e)),t.appendChild(a)}),t},newGame:function(e,a){var t=this,n=document.querySelector('.main__start-screen'),r=document.querySelector('.main__win-screen'),c=document.createDocumentFragment();if(!document.querySelector('.main__controls')){var o=this.createElement('span',{className:'controls__new-game',dataTid:'Menu-newGame'},'Начать заново'),d=this.createElement('span',{className:'controls__title'},'Очки: '),m=this.createElement('span',{className:'controls__score',dataTid:'Menu-scores'}),l=this.createElement('div',{className:'controls__wrapper'},d,m),u=this.createElement('section',{className:'main__controls'},o,l);o.addEventListener('click',f.resetGame),c.appendChild(u)}n&&n.remove(),r&&r.remove();var _=this.createElement('div',{className:'main__cards-grid',dataTid:'Deck'});e.forEach(function(e){var a=t.addCard(e.dataId,e.alt,e.src);_.appendChild(a)});var h=this.createElement('section',{className:'main__cards'},_);c.appendChild(h),i.appendChild(c),s=document.querySelector('.controls__score'),document.querySelectorAll('.main__card').forEach(function(e){e.addEventListener('click',f.onCardClick),setTimeout(function(){e.classList.add('card__flipped'),setTimeout(function(){e.classList.remove('card__flipped')},a)},100)}),this.cardFlipAudio(),setTimeout(function(){t.cardFlipAudio()},a)},addCard:function(e,a,t){var n=this.createElement('img',{src:'images/card_back.svg',alt:'Back of the card'}),r=this.createElement('div',{className:'card__back',dataTid:'Card-flipped'},n),i=this.createElement('img',{className:'card__icon',dataId:e,src:t,alt:a}),c=this.createElement('div',{className:'card__front'},i),s=this.createElement('div',{className:'main__card',dataTid:'Card'},r,c);return this.createElement('div',{className:'main__card-wrapper'},s)},cardFlipAudio:function(){c.currentTime=0,c.play()},openCard:function(e){e.target.classList.add('card__flipped'),this.cardFlipAudio()},noEventsOnCard:function(e){e.classList.add('card__no-events')},fadeOutPair:function(e,a){e.parentNode.classList.add('fade-out'),a.parentNode.classList.add('fade-out')},addShake:function(e,a){e.classList.add('shake'),a.classList.add('shake')},removeShake:function(e,a){e.classList.remove('shake'),a.classList.remove('shake')},closeBothCards:function(e,a){e.classList.remove('card__flipped','card__no-events'),a.classList.remove('card__flipped'),this.cardFlipAudio()},printScore:function(e){s.textContent=e}}),f=(o=500,d=null,m=null,l=!0,{init:function(){u.init(9),_.init(o)},newGame:function(){l=!1,u.reset(),u.makeRandomPairs(9),_.newGame(u.getRandomCards(),5e3),_.printScore(u.getScore()),setTimeout(function(){l=!0},5750)},resetGame:function(){u.reset(),_.reset(),_.printScore(u.getScore()),u.makeRandomPairs(9),_.newGame(u.getRandomCards(),5e3),d=null,m=null,l=!0},onCardClick:function(e){var a=e.target,t=a.querySelector('.card__icon').dataset.id;d&&l?(_.openCard(e),m===t?(l=!1,u.countingScore('plus'),setTimeout(function(){_.fadeOutPair(d,a),d=null,setTimeout(function(){l=!0},300)},o)):(l=!1,u.countingScore('minus'),setTimeout(function(){_.addShake(d,a),setTimeout(function(){_.removeShake(d,a),setTimeout(function(){_.closeBothCards(d,a),d=null,setTimeout(function(){l=!0},300)},100)},700)},o))):l&&(_.openCard(e),d=a,_.noEventsOnCard(d),m=d.querySelector('.card__icon').dataset.id,l=!1,setTimeout(function(){l=!0},200)),_.printScore(u.getScore())},win:function(){setTimeout(function(){_.win(u.getScore())},1250)}});f.init()}();